meta:
  name: "Gas scanner demo app"
  author: "GolemFactory"
  version: "0.1.0"
payloads:
  mongo:
    runtime: "vm"
    params:
      image_hash: "69dec7e8e106143d317516580d8e8f36ec014f484eb73b79a042a1f8"
  backend:
    runtime: "vm"
    params:
      image_hash: "7e671bbcbf15686278cf72f76847acf4414980a993e48273860f206b"
nodes:
  mongo:
    payload: "mongo"
    init:
      - run:
          args: ["/bin/bash", "-c", "/usr/local/bin/docker-entrypoint.sh /usr/bin/mongod --bind_ip_all &"]
    network: "default"
    ip:
      - "192.168.0.2"
  backend:
    payload: "backend"
    init:
      - run:
          args: [
            "/bin/sh", "-c",
            "PROVIDER_ADDRESS='https://bor.golem.network';
            MONGO_DB_CONNECTION_STRING='mongodb://192.168.0.2:27017';
            MONGO_DB_NAME='GasUsage';
            AGGREGATOR_DELAY_START='60';
            AGGREGATOR_DELAY_SECONDS='60';
            COLD_START_BLOCK='-1';
            WATCHDOG_START_AGGREGATOR='node dist/gas_scanner_aggregator.js';
            WATCHDOG_START_SERVER='node dist/gas_scanner_server.js';
            WATCHDOG_START_COMMAND='node dist/gas_scanner_main.js --fillMissingBlocks --clearDatabase';
            WATCHDOG_AFTER_KILL_DELAY_MS=5000;
            WATCHDOG_AFTER_START_DELAY_MS=15000;
            WATCHDOG_ALLOWED_SECONDS_BEHIND=30;
            WATCHDOG_CHECK_EVERY_MS=250000;
            SERVER_LISTEN_PORT=7888;
            SERVER_CACHE_VALIDITY=3000;
            node dist/gas_scanner_watchdog.js &"
            ]
    http_proxy:
      ports:
        - "7888"
    network: "default"
    ip:
      - "192.168.0.3"
    depends_on:
      - "mongo"
networks:
  default:
    ip: "192.168.0.0/24"
